!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t=t||self).EventProxy=n()}(this,(function(){"use strict";var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};function n(n,e){function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}var e=function(){function t(){this._event_cb_pool={}}return t.prototype.addEvent=function(t,n){this._event_cb_pool[t]||(this._event_cb_pool[t]=[]),this._event_cb_pool[t].push(n)},t.prototype.addUnionEvent=function(t,n){var e=this;t.forEach((function(t){e.addEvent(t,n)}))},t.prototype.removeEvent=function(t,n){var e=this._event_cb_pool[t];if(e){var o=e.filter((function(t){return t!==n}));this._event_cb_pool[t]=o,0===o.length&&delete this._event_cb_pool[t]}},t.prototype.removeUnionEvent=function(t,n){var e=this;t.forEach((function(t){e.removeEvent(t,n)}))},t.prototype.emitEvent=function(t,n){var e=this._event_cb_pool[t];e&&e.forEach((function(e){return e.emitEvent(t,n)}))},t}(),o=function(){function t(t,n){var e=this;this._union_event_data_pool={},this._union_event=[],t.forEach((function(t){e._union_event_data_pool[t]=[]})),this._union_event=t,this._cb=n}return t.prototype.emitEvent=function(t,n){var e=this._union_event_data_pool[t];e&&e.push(n),this.checkEventDataReady()&&this.execEventCallback()},t.prototype.checkEventDataReady=function(){var t=this;return this._union_event.every((function(n){return t._union_event_data_pool[n].length>0}))},t.prototype.execEventCallback=function(){var t=this,n=[];this._union_event.forEach((function(e){n.push(t._union_event_data_pool[e].pop())})),this._cb.apply(this,n)},t}(),r=function(t){function e(n,e){return t.call(this,[n],e)||this}return n(e,t),e}(o);return function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.create=function(){return new e},e.prototype.register=function(t,n){if(t.length<=0)throw new Error("EventName cannot be empty!");if("string"==typeof t){var e=new r(t,n);return this.addEvent(t,e),this.removeEvent.bind(this,t,e)}t=function(t){var n=[];return t.forEach((function(t){-1===n.indexOf(t)&&n.push(t)})),n}(t);var i=new o(t,n);return this.addUnionEvent(t,i),this.removeUnionEvent.bind(this,t,i)},e.prototype.on=function(t,n){return this.register(t,n)},e.prototype.bind=function(t,n){return this.register(t,n)},e.prototype.subscribe=function(t,n){return this.register(t,n)},e.prototype.once=function(t,n){var e=this.register(t,(function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];n.apply(void 0,t),e()}));return e},e.prototype.bindNTime=function(t,n,e){if(n<=0)throw new Error("bindTime can't less than 1");var o=0,r=this.register(t,(function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];o++,e.apply(void 0,t),o>=n&&r()}));return r},e.prototype.wait=function(t,n,e){if(n<=0)throw new Error("waitCount can't less than 1");var o=[];return this.register(t,(function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];o.push(t)<n||(e.apply(void 0,o),o=[])}))},e.prototype.emit=function(t,n){this.emitEvent(t,n)},e.prototype.done=function(t,n){this.emit(t,n)},e}(e)}));
